"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var element_registry_1 = require("nativescript-angular/element-registry");
var firebase = require("nativescript-plugin-firebase");
var barcodescanning_1 = require("nativescript-plugin-firebase/mlkit/barcodescanning");
var image_source_1 = require("tns-core-modules/image-source");
var file_system_1 = require("tns-core-modules/file-system");
var FacedetectionComponent = /** @class */ (function () {
    function FacedetectionComponent() {
        // registerElement("MLKitTextRecognition", () => require("nativescript-plugin-firebase/mlkit/textrecognition").MLKitTextRecognition);
        // registerElement("MLKitFaceDetection", () => require("nativescript-plugin-firebase/mlkit/facedetection").MLKitFaceDetection);
        // registerElement("MLKitBarcodeScanner", () => require("nativescript-plugin-firebase/mlkit/barcodescanning").MLKitBarcodeScanner);
        element_registry_1.registerElement("MLKitImageLabeling", function () { return require("nativescript-plugin-firebase/mlkit/imagelabeling").MLKitImageLabeling; });
    }
    FacedetectionComponent.prototype.ngOnInit = function () { };
    FacedetectionComponent.prototype.onImageLabelingResult = function (scanResult) {
        var value = scanResult.value;
        this.labels = value.labels;
        this.labels.forEach(function (label) {
            console.log(label);
        });
    };
    //------------------------ firebase ml kit test ------------------
    FacedetectionComponent.prototype.textRecognition = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/Wege_der_parlamentarischen_Demokratie.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        console.log(imageSource);
        firebase.mlkit.textrecognition.recognizeTextOnDevice({
            image: imageSource // a NativeScript Image or ImageSource, see the demo for examples
        }).then(function (result) {
            console.log(result.text ? result.text : "");
        }).catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.faceDetection = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/sansoo.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.facedetection.detectFacesOnDevice({
            image: imageSource,
            detectionMode: "accurate",
            enableFaceTracking: true,
            minimumFaceSize: 0.25 // default 0.1 (which means the face must be at least 10% of the image)
        })
            .then(function (result) { return console.log(JSON.stringify(result.faces)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.barcodeScanning = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/qrcode.png");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.barcodescanning.scanBarcodesOnDevice({
            image: imageSource,
            formats: [barcodescanning_1.BarcodeFormat.QR_CODE, barcodescanning_1.BarcodeFormat.CODABAR] // limit recognition to certain formats (faster), or leave out entirely for all formats (default)
        })
            .then(function (result) { return console.log(JSON.stringify(result.barcodes)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
        var folderPath2 = file_system_1.path.join(folder.path, "images/EAN-Obst.jpg");
        var imageSource2 = image_source_1.fromFile(folderPath2);
        firebase.mlkit.barcodescanning.scanBarcodesOnDevice({
            image: imageSource2,
            formats: [barcodescanning_1.BarcodeFormat.EAN_13] // limit recognition to certain formats (faster), or leave out entirely for all formats (default)
        })
            .then(function (result) { return console.log(JSON.stringify(result.barcodes)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.imageLabeling = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/1024px-Valais_Cup_2013_-_OM-FC_Porto_13-07-2013_-_Brice_Samba_en_extension.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.imagelabeling.labelImageOnDevice({
            image: imageSource,
            confidenceThreshold: 0.6 // this will only return labels with at least 0.6 (60%) confidence. Default 0.5.
        })
            .then(function (result) { return console.log(JSON.stringify(result.labels)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
        firebase.mlkit.imagelabeling.labelImageCloud({
            image: imageSource,
            modelType: "stable",
            maxResults: 5 // default 10
        })
            .then(function (result) { return console.log(JSON.stringify(result.labels)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.landmarkRecognition = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/680px-Bruegge_View_from_Rozenhoedkaai.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.landmarkrecognition.recognizeLandmarksCloud({
            image: imageSource,
            modelType: "latest",
            maxResults: 8 // default 10
        })
            .then(function (result) { return console.log(JSON.stringify(result.landmarks)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'Facedetection',
            templateUrl: './facedetection.component.html',
            styleUrls: ['./facedetection.component.scss']
        }),
        __metadata("design:paramtypes", [])
    ], FacedetectionComponent);
    return FacedetectionComponent;
}());
exports.FacedetectionComponent = FacedetectionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjZWRldGVjdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmYWNlZGV0ZWN0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFrRDtBQUNsRCwwRUFBd0U7QUFFeEUsdURBQTBEO0FBRzFELHNGQUFvSDtBQUlwSCw4REFBc0U7QUFDdEUsNERBQTBFO0FBUTFFO0lBRUU7UUFDRSxxSUFBcUk7UUFDckksK0hBQStIO1FBQy9ILG1JQUFtSTtRQUNuSSxrQ0FBZSxDQUFDLG9CQUFvQixFQUFFLGNBQU0sT0FBQSxPQUFPLENBQUMsa0RBQWtELENBQUMsQ0FBQyxrQkFBa0IsRUFBOUUsQ0FBOEUsQ0FBQyxDQUFDO0lBQzlILENBQUM7SUFFRCx5Q0FBUSxHQUFSLGNBQWEsQ0FBQztJQU1kLHNEQUFxQixHQUFyQixVQUFzQixVQUFlO1FBQ25DLElBQU0sS0FBSyxHQUFxQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEtBQUs7WUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLRCxrRUFBa0U7SUFDbEUsZ0RBQWUsR0FBZjtRQUNJLElBQU0sTUFBTSxHQUFvQiwwQkFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzFELElBQU0sVUFBVSxHQUFXLGtCQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsa0RBQWtELENBQUMsQ0FBQztRQUN0RyxJQUFNLFdBQVcsR0FBOEIsdUJBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwRSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3pCLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxD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dGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgcmVnaXN0ZXJFbGVtZW50IH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1hbmd1bGFyL2VsZW1lbnQtcmVnaXN0cnlcIjtcblxuaW1wb3J0IGZpcmViYXNlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2VcIik7XG5pbXBvcnQgeyBNTEtpdFJlY29nbml6ZVRleHRSZXN1bHQsIE1MS2l0UmVjb2duaXplVGV4dFJlc3VsdEJsb2NrIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvdGV4dHJlY29nbml0aW9uXCI7XG5pbXBvcnQgeyBNTEtpdERldGVjdEZhY2VzT25EZXZpY2VSZXN1bHQsIE1MS2l0RGV0ZWN0RmFjZXNSZXN1bHRGYWNlIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvZmFjZWRldGVjdGlvblwiO1xuaW1wb3J0IHsgQmFyY29kZUZvcm1hdCwgTUxLaXRTY2FuQmFyY29kZXNPbkRldmljZVJlc3VsdCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2JhcmNvZGVzY2FubmluZ1wiO1xuaW1wb3J0IHsgTUxLaXRJbWFnZUxhYmVsaW5nT25EZXZpY2VSZXN1bHQgfSBmcm9tIFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9tbGtpdC9pbWFnZWxhYmVsaW5nXCI7XG5pbXBvcnQgeyBNTEtpdEltYWdlTGFiZWxpbmdDbG91ZFJlc3VsdCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2ltYWdlbGFiZWxpbmdcIjtcbmltcG9ydCB7IE1MS2l0TGFuZG1hcmtSZWNvZ25pdGlvbkNsb3VkUmVzdWx0IH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvbGFuZG1hcmtyZWNvZ25pdGlvblwiO1xuaW1wb3J0IHsgSW1hZ2VTb3VyY2UsIGZyb21GaWxlIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvaW1hZ2Utc291cmNlXCI7XG5pbXBvcnQgeyBGb2xkZXIsIHBhdGgsIGtub3duRm9sZGVycyB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL2ZpbGUtc3lzdGVtXCI7XG5cbkBDb21wb25lbnQoe1xuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICBzZWxlY3RvcjogJ0ZhY2VkZXRlY3Rpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vZmFjZWRldGVjdGlvbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2ZhY2VkZXRlY3Rpb24uY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBGYWNlZGV0ZWN0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIHJlZ2lzdGVyRWxlbWVudChcIk1MS2l0VGV4dFJlY29nbml0aW9uXCIsICgpID0+IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L3RleHRyZWNvZ25pdGlvblwiKS5NTEtpdFRleHRSZWNvZ25pdGlvbik7XG4gICAgLy8gcmVnaXN0ZXJFbGVtZW50KFwiTUxLaXRGYWNlRGV0ZWN0aW9uXCIsICgpID0+IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2ZhY2VkZXRlY3Rpb25cIikuTUxLaXRGYWNlRGV0ZWN0aW9uKTtcbiAgICAvLyByZWdpc3RlckVsZW1lbnQoXCJNTEtpdEJhcmNvZGVTY2FubmVyXCIsICgpID0+IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2JhcmNvZGVzY2FubmluZ1wiKS5NTEtpdEJhcmNvZGVTY2FubmVyKTtcbiAgICByZWdpc3RlckVsZW1lbnQoXCJNTEtpdEltYWdlTGFiZWxpbmdcIiwgKCkgPT4gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvaW1hZ2VsYWJlbGluZ1wiKS5NTEtpdEltYWdlTGFiZWxpbmcpO1xuICB9XG4gIFxuICBuZ09uSW5pdCgpIHsgfVxuXG4gIGxhYmVsczogQXJyYXk8e1xuICAgIHRleHQ6IHN0cmluZztcbiAgICBjb25maWRlbmNlOiBudW1iZXI7XG4gIH0+O1xuICBvbkltYWdlTGFiZWxpbmdSZXN1bHQoc2NhblJlc3VsdDogYW55KTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWU6IE1MS2l0SW1hZ2VMYWJlbGluZ09uRGV2aWNlUmVzdWx0ID0gc2NhblJlc3VsdC52YWx1ZTtcbiAgICB0aGlzLmxhYmVscyA9IHZhbHVlLmxhYmVscztcbiAgICB0aGlzLmxhYmVscy5mb3JFYWNoKGxhYmVsID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGxhYmVsKTtcbiAgICB9KTtcbiAgfVxuXG5cblxuXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGZpcmViYXNlIG1sIGtpdCB0ZXN0IC0tLS0tLS0tLS0tLS0tLS0tLVxuICB0ZXh0UmVjb2duaXRpb24oKXtcbiAgICAgIGNvbnN0IGZvbGRlcjogRm9sZGVyID0gPEZvbGRlcj4ga25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvV2VnZV9kZXJfcGFybGFtZW50YXJpc2NoZW5fRGVtb2tyYXRpZS5qcGdcIik7XG4gICAgICBjb25zdCBpbWFnZVNvdXJjZTogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgpO1xuXG4gICAgICBjb25zb2xlLmxvZyhpbWFnZVNvdXJjZSk7XG4gICAgICBmaXJlYmFzZS5tbGtpdC50ZXh0cmVjb2duaXRpb24ucmVjb2duaXplVGV4dE9uRGV2aWNlKHtcbiAgICAgICAgICBpbWFnZTogaW1hZ2VTb3VyY2UgLy8gYSBOYXRpdmVTY3JpcHQgSW1hZ2Ugb3IgSW1hZ2VTb3VyY2UsIHNlZSB0aGUgZGVtbyBmb3IgZXhhbXBsZXNcbiAgICAgIH0pLnRoZW4oKHJlc3VsdDogTUxLaXRSZWNvZ25pemVUZXh0UmVzdWx0KSA9PiB7IC8vIGp1c3QgbG9vayBhdCB0aGlzIHR5cGUgdG8gc2VlIHdoYXQgZWxzZSBpcyByZXR1cm5lZFxuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC50ZXh0ID8gcmVzdWx0LnRleHQgOiBcIlwiKTtcbiAgICAgIH0pLmNhdGNoKGVycm9yTWVzc2FnZSA9PiBjb25zb2xlLmxvZyhcIk1MIEtpdCBlcnJvcjogXCIgKyBlcnJvck1lc3NhZ2UpKTtcbiAgfVxuXG4gIGZhY2VEZXRlY3Rpb24oKXtcbiAgICAgIGNvbnN0IGZvbGRlcjogRm9sZGVyID0gPEZvbGRlcj4ga25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvc2Fuc29vLmpwZ1wiKTtcbiAgICAgIGNvbnN0IGltYWdlU291cmNlOiBJbWFnZVNvdXJjZSA9IDxJbWFnZVNvdXJjZT4gZnJvbUZpbGUoZm9sZGVyUGF0aCk7XG4gICAgICBmaXJlYmFzZS5tbGtpdC5mYWNlZGV0ZWN0aW9uLmRldGVjdEZhY2VzT25EZXZpY2Uoe1xuICAgICAgICAgIGltYWdlOiBpbWFnZVNvdXJjZSwgLy8gYSBOYXRpdmVTY3JpcHQgSW1hZ2Ugb3IgSW1hZ2VTb3VyY2UsIHNlZSB0aGUgZGVtbyBmb3IgZXhhbXBsZXNcbiAgICAgICAgICBkZXRlY3Rpb25Nb2RlOiBcImFjY3VyYXRlXCIsIC8vIGRlZmF1bHQgXCJmYXN0XCJcbiAgICAgICAgICBlbmFibGVGYWNlVHJhY2tpbmc6IHRydWUsIC8vIGRlZmF1bHQgZmFsc2VcbiAgICAgICAgICBtaW5pbXVtRmFjZVNpemU6IDAuMjUgLy8gZGVmYXVsdCAwLjEgKHdoaWNoIG1lYW5zIHRoZSBmYWNlIG11c3QgYmUgYXQgbGVhc3QgMTAlIG9mIHRoZSBpbWFnZSlcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzdWx0OiBNTEtpdERldGVjdEZhY2VzT25EZXZpY2VSZXN1bHQpID0+IGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5mYWNlcykpKVxuICAgICAgLmNhdGNoKGVycm9yTWVzc2FnZSA9PiBjb25zb2xlLmxvZyhcIk1MIEtpdCBlcnJvcjogXCIgKyBlcnJvck1lc3NhZ2UpKTtcbiAgfVxuICBiYXJjb2RlU2Nhbm5pbmcoKXtcbiAgICAgIGNvbnN0IGZvbGRlcjogRm9sZGVyID0gPEZvbGRlcj4ga25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvcXJjb2RlLnBuZ1wiKTtcbiAgICAgIGNvbnN0IGltYWdlU291cmNlOiBJbWFnZVNvdXJjZSA9IDxJbWFnZVNvdXJjZT4gZnJvbUZpbGUoZm9sZGVyUGF0aCk7XG4gICAgICBmaXJlYmFzZS5tbGtpdC5iYXJjb2Rlc2Nhbm5pbmcuc2NhbkJhcmNvZGVzT25EZXZpY2Uoe1xuICAgICAgICAgIGltYWdlOiBpbWFnZVNvdXJjZSxcbiAgICAgICAgICBmb3JtYXRzOiBbQmFyY29kZUZvcm1hdC5RUl9DT0RFLCBCYXJjb2RlRm9ybWF0LkNPREFCQVJdIC8vIGxpbWl0IHJlY29nbml0aW9uIHRvIGNlcnRhaW4gZm9ybWF0cyAoZmFzdGVyKSwgb3IgbGVhdmUgb3V0IGVudGlyZWx5IGZvciBhbGwgZm9ybWF0cyAoZGVmYXVsdClcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzdWx0OiBNTEtpdFNjYW5CYXJjb2Rlc09uRGV2aWNlUmVzdWx0KSA9PiBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQuYmFyY29kZXMpKSlcbiAgICAgIC5jYXRjaChlcnJvck1lc3NhZ2UgPT4gY29uc29sZS5sb2coXCJNTCBLaXQgZXJyb3I6IFwiICsgZXJyb3JNZXNzYWdlKSk7XG5cbiAgICAgIGNvbnN0IGZvbGRlclBhdGgyOiBzdHJpbmcgPSBwYXRoLmpvaW4oZm9sZGVyLnBhdGgsIFwiaW1hZ2VzL0VBTi1PYnN0LmpwZ1wiKTtcbiAgICAgIGNvbnN0IGltYWdlU291cmNlMjogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgyKTtcbiAgICAgIGZpcmViYXNlLm1sa2l0LmJhcmNvZGVzY2FubmluZy5zY2FuQmFyY29kZXNPbkRldmljZSh7XG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlMixcbiAgICAgICAgICBmb3JtYXRzOiBbQmFyY29kZUZvcm1hdC5FQU5fMTNdIC8vIGxpbWl0IHJlY29nbml0aW9uIHRvIGNlcnRhaW4gZm9ybWF0cyAoZmFzdGVyKSwgb3IgbGVhdmUgb3V0IGVudGlyZWx5IGZvciBhbGwgZm9ybWF0cyAoZGVmYXVsdClcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzdWx0OiBNTEtpdFNjYW5CYXJjb2Rlc09uRGV2aWNlUmVzdWx0KSA9PiBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQuYmFyY29kZXMpKSlcbiAgICAgIC5jYXRjaChlcnJvck1lc3NhZ2UgPT4gY29uc29sZS5sb2coXCJNTCBLaXQgZXJyb3I6IFwiICsgZXJyb3JNZXNzYWdlKSk7XG4gIH1cbiAgaW1hZ2VMYWJlbGluZygpe1xuICAgICAgY29uc3QgZm9sZGVyOiBGb2xkZXIgPSA8Rm9sZGVyPiBrbm93bkZvbGRlcnMuY3VycmVudEFwcCgpO1xuICAgICAgY29uc3QgZm9sZGVyUGF0aDogc3RyaW5nID0gcGF0aC5qb2luKGZvbGRlci5wYXRoLCBcImltYWdlcy8xMDI0cHgtVmFsYWlzX0N1cF8yMDEzXy1fT00tRkNfUG9ydG9fMTMtMDctMjAxM18tX0JyaWNlX1NhbWJhX2VuX2V4dGVuc2lvbi5qcGdcIik7XG4gICAgICBjb25zdCBpbWFnZVNvdXJjZTogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgpO1xuXG4gICAgICBmaXJlYmFzZS5tbGtpdC5pbWFnZWxhYmVsaW5nLmxhYmVsSW1hZ2VPbkRldmljZSh7XG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLFxuICAgICAgICAgIGNvbmZpZGVuY2VUaHJlc2hvbGQ6IDAuNiAvLyB0aGlzIHdpbGwgb25seSByZXR1cm4gbGFiZWxzIHdpdGggYXQgbGVhc3QgMC42ICg2MCUpIGNvbmZpZGVuY2UuIERlZmF1bHQgMC41LlxuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXN1bHQ6IE1MS2l0SW1hZ2VMYWJlbGluZ09uRGV2aWNlUmVzdWx0KSA9PiBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQubGFiZWxzKSkpXG4gICAgICAuY2F0Y2goZXJyb3JNZXNzYWdlID0+IGNvbnNvbGUubG9nKFwiTUwgS2l0IGVycm9yOiBcIiArIGVycm9yTWVzc2FnZSkpO1xuXG4gICAgICBmaXJlYmFzZS5tbGtpdC5pbWFnZWxhYmVsaW5nLmxhYmVsSW1hZ2VDbG91ZCh7XG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLFxuICAgICAgICAgIG1vZGVsVHlwZTogXCJzdGFibGVcIiwgLy8gZWl0aGVyIFwibGF0ZXN0XCIgb3IgXCJzdGFibGVcIiAoZGVmYXVsdCBcInN0YWJsZVwiKVxuICAgICAgICAgIG1heFJlc3VsdHM6IDUgLy8gZGVmYXVsdCAxMFxuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXN1bHQ6IE1MS2l0SW1hZ2VMYWJlbGluZ0Nsb3VkUmVzdWx0KSA9PiBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQubGFiZWxzKSkpXG4gICAgICAuY2F0Y2goZXJyb3JNZXNzYWdlID0+IGNvbnNvbGUubG9nKFwiTUwgS2l0IGVycm9yOiBcIiArIGVycm9yTWVzc2FnZSkpO1xuICB9XG4gIGxhbmRtYXJrUmVjb2duaXRpb24oKXtcbiAgICAgIGNvbnN0IGZvbGRlcjogRm9sZGVyID0gPEZvbGRlcj4ga25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvNjgwcHgtQnJ1ZWdnZV9WaWV3X2Zyb21fUm96ZW5ob2Vka2FhaS5qcGdcIik7XG4gICAgICBjb25zdCBpbWFnZVNvdXJjZTogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgpO1xuICAgICAgZmlyZWJhc2UubWxraXQubGFuZG1hcmtyZWNvZ25pdGlvbi5yZWNvZ25pemVMYW5kbWFya3NDbG91ZCh7XG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLFxuICAgICAgICAgIG1vZGVsVHlwZTogXCJsYXRlc3RcIiwgLy8gZWl0aGVyIFwibGF0ZXN0XCIgb3IgXCJzdGFibGVcIiAoZGVmYXVsdCBcInN0YWJsZVwiKVxuICAgICAgICAgIG1heFJlc3VsdHM6IDggLy8gZGVmYXVsdCAxMFxuICAgICAgfSlcbiAgICAgIC50aGVuKChyZXN1bHQ6IE1MS2l0TGFuZG1hcmtSZWNvZ25pdGlvbkNsb3VkUmVzdWx0KSA9PiBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZXN1bHQubGFuZG1hcmtzKSkpXG4gICAgICAuY2F0Y2goZXJyb3JNZXNzYWdlID0+IGNvbnNvbGUubG9nKFwiTUwgS2l0IGVycm9yOiBcIiArIGVycm9yTWVzc2FnZSkpO1xuICB9XG59XG4iXX0=