"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var element_registry_1 = require("nativescript-angular/element-registry");
var firebase = require("nativescript-plugin-firebase");
var barcodescanning_1 = require("nativescript-plugin-firebase/mlkit/barcodescanning");
var image_source_1 = require("tns-core-modules/image-source");
var file_system_1 = require("tns-core-modules/file-system");
var FacedetectionComponent = /** @class */ (function () {
    function FacedetectionComponent() {
        // registerElement("MLKitTextRecognition", () => require("nativescript-plugin-firebase/mlkit/textrecognition").MLKitTextRecognition);
        // registerElement("MLKitFaceDetection", () => require("nativescript-plugin-firebase/mlkit/facedetection").MLKitFaceDetection);
        // registerElement("MLKitBarcodeScanner", () => require("nativescript-plugin-firebase/mlkit/barcodescanning").MLKitBarcodeScanner);
        element_registry_1.registerElement("MLKitImageLabeling", function () { return require("nativescript-plugin-firebase/mlkit/imagelabeling").MLKitImageLabeling; });
    }
    FacedetectionComponent.prototype.ngOnInit = function () { };
    FacedetectionComponent.prototype.onImageLabelingResult = function (scanResult) {
        var value = scanResult.value;
        this.labels = value.labels;
        this.labels.forEach(function (label) {
            console.log(label);
        });
    };
    //------------------------ firebase ml kit test ------------------
    FacedetectionComponent.prototype.textRecognition = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/Wege_der_parlamentarischen_Demokratie.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        console.log(imageSource);
        firebase.mlkit.textrecognition.recognizeTextOnDevice({
            image: imageSource // a NativeScript Image or ImageSource, see the demo for examples
        }).then(function (result) {
            console.log(result.text ? result.text : "");
        }).catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.faceDetection = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/sansoo.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.facedetection.detectFacesOnDevice({
            image: imageSource,
            detectionMode: "accurate",
            enableFaceTracking: true,
            minimumFaceSize: 0.25 // default 0.1 (which means the face must be at least 10% of the image)
        })
            .then(function (result) { return console.log(JSON.stringify(result.faces)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.barcodeScanning = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/qrcode.png");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.barcodescanning.scanBarcodesOnDevice({
            image: imageSource,
            formats: [barcodescanning_1.BarcodeFormat.QR_CODE, barcodescanning_1.BarcodeFormat.CODABAR] // limit recognition to certain formats (faster), or leave out entirely for all formats (default)
        })
            .then(function (result) { return console.log(JSON.stringify(result.barcodes)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
        var folderPath2 = file_system_1.path.join(folder.path, "images/EAN-Obst.jpg");
        var imageSource2 = image_source_1.fromFile(folderPath2);
        firebase.mlkit.barcodescanning.scanBarcodesOnDevice({
            image: imageSource2,
            formats: [barcodescanning_1.BarcodeFormat.EAN_13] // limit recognition to certain formats (faster), or leave out entirely for all formats (default)
        })
            .then(function (result) { return console.log(JSON.stringify(result.barcodes)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.imageLabeling = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/1024px-Valais_Cup_2013_-_OM-FC_Porto_13-07-2013_-_Brice_Samba_en_extension.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.imagelabeling.labelImageOnDevice({
            image: imageSource,
            confidenceThreshold: 0.6 // this will only return labels with at least 0.6 (60%) confidence. Default 0.5.
        })
            .then(function (result) { return console.log(JSON.stringify(result.labels)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
        firebase.mlkit.imagelabeling.labelImageCloud({
            image: imageSource,
            modelType: "stable",
            maxResults: 5 // default 10
        })
            .then(function (result) { return console.log(JSON.stringify(result.labels)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent.prototype.landmarkRecognition = function () {
        var folder = file_system_1.knownFolders.currentApp();
        var folderPath = file_system_1.path.join(folder.path, "images/680px-Bruegge_View_from_Rozenhoedkaai.jpg");
        var imageSource = image_source_1.fromFile(folderPath);
        firebase.mlkit.landmarkrecognition.recognizeLandmarksCloud({
            image: imageSource,
            modelType: "latest",
            maxResults: 8 // default 10
        })
            .then(function (result) { return console.log(JSON.stringify(result.landmarks)); })
            .catch(function (errorMessage) { return console.log("ML Kit error: " + errorMessage); });
    };
    FacedetectionComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'Facedetection',
            templateUrl: './facedetection.component.html',
            styleUrls: ['./facedetection.component.scss']
        }),
        __metadata("design:paramtypes", [])
    ], FacedetectionComponent);
    return FacedetectionComponent;
}());
exports.FacedetectionComponent = FacedetectionComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjZWRldGVjdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmYWNlZGV0ZWN0aW9uLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUFrRDtBQUNsRCwwRUFBd0U7QUFFeEUsdURBQTBEO0FBRzFELHNGQUFvSDtBQUlwSCw4REFBc0U7QUFDdEUsNERBQTBFO0FBUTFFO0lBRUU7UUFDRSxxSUFBcUk7UUFDckksK0hBQStIO1FBQy9ILG1JQUFtSTtRQUNuSSxrQ0FBZSxDQUFDLG9CQUFvQixFQUFFLGNBQU0sT0FBQSxPQUFPLENBQUMsa0RBQWtELENBQUMsQ0FBQyxrQkFBa0IsRUFBOUUsQ0FBOEUsQ0FBQyxDQUFDO0lBQzlILENBQUM7SUFFRCx5Q0FBUSxHQUFSLGNBQWEsQ0FBQztJQU1kLHNEQUFxQixHQUFyQixVQUFzQixVQUFlO1FBQ25DLElBQU0sS0FBSyxHQUFxQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQ2pFLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEtBQUs7WUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLRCxrRUFBa0U7SUFDbEUsZ0RBQWUsR0FBZjtRQUNJLElBQU0sTUFBTSxHQUFvQiwwQkFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzFELElBQU0sVUFBVSxHQUFXLGtCQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsa0RBQWtELENBQUMsQ0FBQztRQUN0RyxJQUFNLFdBQVcsR0FBOEIsdUJBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwRSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3pCLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxD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dGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyByZWdpc3RlckVsZW1lbnQgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWFuZ3VsYXIvZWxlbWVudC1yZWdpc3RyeVwiO1xyXG5cclxuaW1wb3J0IGZpcmViYXNlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2VcIik7XHJcbmltcG9ydCB7IE1MS2l0UmVjb2duaXplVGV4dFJlc3VsdCwgTUxLaXRSZWNvZ25pemVUZXh0UmVzdWx0QmxvY2sgfSBmcm9tIFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9tbGtpdC90ZXh0cmVjb2duaXRpb25cIjtcclxuaW1wb3J0IHsgTUxLaXREZXRlY3RGYWNlc09uRGV2aWNlUmVzdWx0LCBNTEtpdERldGVjdEZhY2VzUmVzdWx0RmFjZSB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2ZhY2VkZXRlY3Rpb25cIjtcclxuaW1wb3J0IHsgQmFyY29kZUZvcm1hdCwgTUxLaXRTY2FuQmFyY29kZXNPbkRldmljZVJlc3VsdCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2JhcmNvZGVzY2FubmluZ1wiO1xyXG5pbXBvcnQgeyBNTEtpdEltYWdlTGFiZWxpbmdPbkRldmljZVJlc3VsdCB9IGZyb20gXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2ltYWdlbGFiZWxpbmdcIjtcclxuaW1wb3J0IHsgTUxLaXRJbWFnZUxhYmVsaW5nQ2xvdWRSZXN1bHQgfSBmcm9tIFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9tbGtpdC9pbWFnZWxhYmVsaW5nXCI7XHJcbmltcG9ydCB7IE1MS2l0TGFuZG1hcmtSZWNvZ25pdGlvbkNsb3VkUmVzdWx0IH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvbGFuZG1hcmtyZWNvZ25pdGlvblwiO1xyXG5pbXBvcnQgeyBJbWFnZVNvdXJjZSwgZnJvbUZpbGUgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9pbWFnZS1zb3VyY2VcIjtcclxuaW1wb3J0IHsgRm9sZGVyLCBwYXRoLCBrbm93bkZvbGRlcnMgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy9maWxlLXN5c3RlbVwiO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgbW9kdWxlSWQ6IG1vZHVsZS5pZCxcclxuICBzZWxlY3RvcjogJ0ZhY2VkZXRlY3Rpb24nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9mYWNlZGV0ZWN0aW9uLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9mYWNlZGV0ZWN0aW9uLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIEZhY2VkZXRlY3Rpb25Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIFxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgLy8gcmVnaXN0ZXJFbGVtZW50KFwiTUxLaXRUZXh0UmVjb2duaXRpb25cIiwgKCkgPT4gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1wbHVnaW4tZmlyZWJhc2UvbWxraXQvdGV4dHJlY29nbml0aW9uXCIpLk1MS2l0VGV4dFJlY29nbml0aW9uKTtcclxuICAgIC8vIHJlZ2lzdGVyRWxlbWVudChcIk1MS2l0RmFjZURldGVjdGlvblwiLCAoKSA9PiByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9tbGtpdC9mYWNlZGV0ZWN0aW9uXCIpLk1MS2l0RmFjZURldGVjdGlvbik7XHJcbiAgICAvLyByZWdpc3RlckVsZW1lbnQoXCJNTEtpdEJhcmNvZGVTY2FubmVyXCIsICgpID0+IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtcGx1Z2luLWZpcmViYXNlL21sa2l0L2JhcmNvZGVzY2FubmluZ1wiKS5NTEtpdEJhcmNvZGVTY2FubmVyKTtcclxuICAgIHJlZ2lzdGVyRWxlbWVudChcIk1MS2l0SW1hZ2VMYWJlbGluZ1wiLCAoKSA9PiByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXBsdWdpbi1maXJlYmFzZS9tbGtpdC9pbWFnZWxhYmVsaW5nXCIpLk1MS2l0SW1hZ2VMYWJlbGluZyk7XHJcbiAgfVxyXG4gIFxyXG4gIG5nT25Jbml0KCkgeyB9XHJcblxyXG4gIGxhYmVsczogQXJyYXk8e1xyXG4gICAgdGV4dDogc3RyaW5nO1xyXG4gICAgY29uZmlkZW5jZTogbnVtYmVyO1xyXG4gIH0+O1xyXG4gIG9uSW1hZ2VMYWJlbGluZ1Jlc3VsdChzY2FuUmVzdWx0OiBhbnkpOiB2b2lkIHtcclxuICAgIGNvbnN0IHZhbHVlOiBNTEtpdEltYWdlTGFiZWxpbmdPbkRldmljZVJlc3VsdCA9IHNjYW5SZXN1bHQudmFsdWU7XHJcbiAgICB0aGlzLmxhYmVscyA9IHZhbHVlLmxhYmVscztcclxuICAgIHRoaXMubGFiZWxzLmZvckVhY2gobGFiZWwgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhsYWJlbCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuXHJcblxyXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGZpcmViYXNlIG1sIGtpdCB0ZXN0IC0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIHRleHRSZWNvZ25pdGlvbigpe1xyXG4gICAgICBjb25zdCBmb2xkZXI6IEZvbGRlciA9IDxGb2xkZXI+IGtub3duRm9sZGVycy5jdXJyZW50QXBwKCk7XHJcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvV2VnZV9kZXJfcGFybGFtZW50YXJpc2NoZW5fRGVtb2tyYXRpZS5qcGdcIik7XHJcbiAgICAgIGNvbnN0IGltYWdlU291cmNlOiBJbWFnZVNvdXJjZSA9IDxJbWFnZVNvdXJjZT4gZnJvbUZpbGUoZm9sZGVyUGF0aCk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhpbWFnZVNvdXJjZSk7XHJcbiAgICAgIGZpcmViYXNlLm1sa2l0LnRleHRyZWNvZ25pdGlvbi5yZWNvZ25pemVUZXh0T25EZXZpY2Uoe1xyXG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlIC8vIGEgTmF0aXZlU2NyaXB0IEltYWdlIG9yIEltYWdlU291cmNlLCBzZWUgdGhlIGRlbW8gZm9yIGV4YW1wbGVzXHJcbiAgICAgIH0pLnRoZW4oKHJlc3VsdDogTUxLaXRSZWNvZ25pemVUZXh0UmVzdWx0KSA9PiB7IC8vIGp1c3QgbG9vayBhdCB0aGlzIHR5cGUgdG8gc2VlIHdoYXQgZWxzZSBpcyByZXR1cm5lZFxyXG4gICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0LnRleHQgPyByZXN1bHQudGV4dCA6IFwiXCIpO1xyXG4gICAgICB9KS5jYXRjaChlcnJvck1lc3NhZ2UgPT4gY29uc29sZS5sb2coXCJNTCBLaXQgZXJyb3I6IFwiICsgZXJyb3JNZXNzYWdlKSk7XHJcbiAgfVxyXG5cclxuICBmYWNlRGV0ZWN0aW9uKCl7XHJcbiAgICAgIGNvbnN0IGZvbGRlcjogRm9sZGVyID0gPEZvbGRlcj4ga25vd25Gb2xkZXJzLmN1cnJlbnRBcHAoKTtcclxuICAgICAgY29uc3QgZm9sZGVyUGF0aDogc3RyaW5nID0gcGF0aC5qb2luKGZvbGRlci5wYXRoLCBcImltYWdlcy9zYW5zb28uanBnXCIpO1xyXG4gICAgICBjb25zdCBpbWFnZVNvdXJjZTogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgpO1xyXG4gICAgICBmaXJlYmFzZS5tbGtpdC5mYWNlZGV0ZWN0aW9uLmRldGVjdEZhY2VzT25EZXZpY2Uoe1xyXG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLCAvLyBhIE5hdGl2ZVNjcmlwdCBJbWFnZSBvciBJbWFnZVNvdXJjZSwgc2VlIHRoZSBkZW1vIGZvciBleGFtcGxlc1xyXG4gICAgICAgICAgZGV0ZWN0aW9uTW9kZTogXCJhY2N1cmF0ZVwiLCAvLyBkZWZhdWx0IFwiZmFzdFwiXHJcbiAgICAgICAgICBlbmFibGVGYWNlVHJhY2tpbmc6IHRydWUsIC8vIGRlZmF1bHQgZmFsc2VcclxuICAgICAgICAgIG1pbmltdW1GYWNlU2l6ZTogMC4yNSAvLyBkZWZhdWx0IDAuMSAod2hpY2ggbWVhbnMgdGhlIGZhY2UgbXVzdCBiZSBhdCBsZWFzdCAxMCUgb2YgdGhlIGltYWdlKVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigocmVzdWx0OiBNTEtpdERldGVjdEZhY2VzT25EZXZpY2VSZXN1bHQpID0+IGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5mYWNlcykpKVxyXG4gICAgICAuY2F0Y2goZXJyb3JNZXNzYWdlID0+IGNvbnNvbGUubG9nKFwiTUwgS2l0IGVycm9yOiBcIiArIGVycm9yTWVzc2FnZSkpO1xyXG4gIH1cclxuICBiYXJjb2RlU2Nhbm5pbmcoKXtcclxuICAgICAgY29uc3QgZm9sZGVyOiBGb2xkZXIgPSA8Rm9sZGVyPiBrbm93bkZvbGRlcnMuY3VycmVudEFwcCgpO1xyXG4gICAgICBjb25zdCBmb2xkZXJQYXRoOiBzdHJpbmcgPSBwYXRoLmpvaW4oZm9sZGVyLnBhdGgsIFwiaW1hZ2VzL3FyY29kZS5wbmdcIik7XHJcbiAgICAgIGNvbnN0IGltYWdlU291cmNlOiBJbWFnZVNvdXJjZSA9IDxJbWFnZVNvdXJjZT4gZnJvbUZpbGUoZm9sZGVyUGF0aCk7XHJcbiAgICAgIGZpcmViYXNlLm1sa2l0LmJhcmNvZGVzY2FubmluZy5zY2FuQmFyY29kZXNPbkRldmljZSh7XHJcbiAgICAgICAgICBpbWFnZTogaW1hZ2VTb3VyY2UsXHJcbiAgICAgICAgICBmb3JtYXRzOiBbQmFyY29kZUZvcm1hdC5RUl9DT0RFLCBCYXJjb2RlRm9ybWF0LkNPREFCQVJdIC8vIGxpbWl0IHJlY29nbml0aW9uIHRvIGNlcnRhaW4gZm9ybWF0cyAoZmFzdGVyKSwgb3IgbGVhdmUgb3V0IGVudGlyZWx5IGZvciBhbGwgZm9ybWF0cyAoZGVmYXVsdClcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlc3VsdDogTUxLaXRTY2FuQmFyY29kZXNPbkRldmljZVJlc3VsdCkgPT4gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzdWx0LmJhcmNvZGVzKSkpXHJcbiAgICAgIC5jYXRjaChlcnJvck1lc3NhZ2UgPT4gY29uc29sZS5sb2coXCJNTCBLaXQgZXJyb3I6IFwiICsgZXJyb3JNZXNzYWdlKSk7XHJcblxyXG4gICAgICBjb25zdCBmb2xkZXJQYXRoMjogc3RyaW5nID0gcGF0aC5qb2luKGZvbGRlci5wYXRoLCBcImltYWdlcy9FQU4tT2JzdC5qcGdcIik7XHJcbiAgICAgIGNvbnN0IGltYWdlU291cmNlMjogSW1hZ2VTb3VyY2UgPSA8SW1hZ2VTb3VyY2U+IGZyb21GaWxlKGZvbGRlclBhdGgyKTtcclxuICAgICAgZmlyZWJhc2UubWxraXQuYmFyY29kZXNjYW5uaW5nLnNjYW5CYXJjb2Rlc09uRGV2aWNlKHtcclxuICAgICAgICAgIGltYWdlOiBpbWFnZVNvdXJjZTIsXHJcbiAgICAgICAgICBmb3JtYXRzOiBbQmFyY29kZUZvcm1hdC5FQU5fMTNdIC8vIGxpbWl0IHJlY29nbml0aW9uIHRvIGNlcnRhaW4gZm9ybWF0cyAoZmFzdGVyKSwgb3IgbGVhdmUgb3V0IGVudGlyZWx5IGZvciBhbGwgZm9ybWF0cyAoZGVmYXVsdClcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlc3VsdDogTUxLaXRTY2FuQmFyY29kZXNPbkRldmljZVJlc3VsdCkgPT4gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzdWx0LmJhcmNvZGVzKSkpXHJcbiAgICAgIC5jYXRjaChlcnJvck1lc3NhZ2UgPT4gY29uc29sZS5sb2coXCJNTCBLaXQgZXJyb3I6IFwiICsgZXJyb3JNZXNzYWdlKSk7XHJcbiAgfVxyXG4gIGltYWdlTGFiZWxpbmcoKXtcclxuICAgICAgY29uc3QgZm9sZGVyOiBGb2xkZXIgPSA8Rm9sZGVyPiBrbm93bkZvbGRlcnMuY3VycmVudEFwcCgpO1xyXG4gICAgICBjb25zdCBmb2xkZXJQYXRoOiBzdHJpbmcgPSBwYXRoLmpvaW4oZm9sZGVyLnBhdGgsIFwiaW1hZ2VzLzEwMjRweC1WYWxhaXNfQ3VwXzIwMTNfLV9PTS1GQ19Qb3J0b18xMy0wNy0yMDEzXy1fQnJpY2VfU2FtYmFfZW5fZXh0ZW5zaW9uLmpwZ1wiKTtcclxuICAgICAgY29uc3QgaW1hZ2VTb3VyY2U6IEltYWdlU291cmNlID0gPEltYWdlU291cmNlPiBmcm9tRmlsZShmb2xkZXJQYXRoKTtcclxuXHJcbiAgICAgIGZpcmViYXNlLm1sa2l0LmltYWdlbGFiZWxpbmcubGFiZWxJbWFnZU9uRGV2aWNlKHtcclxuICAgICAgICAgIGltYWdlOiBpbWFnZVNvdXJjZSxcclxuICAgICAgICAgIGNvbmZpZGVuY2VUaHJlc2hvbGQ6IDAuNiAvLyB0aGlzIHdpbGwgb25seSByZXR1cm4gbGFiZWxzIHdpdGggYXQgbGVhc3QgMC42ICg2MCUpIGNvbmZpZGVuY2UuIERlZmF1bHQgMC41LlxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigocmVzdWx0OiBNTEtpdEltYWdlTGFiZWxpbmdPbkRldmljZVJlc3VsdCkgPT4gY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocmVzdWx0LmxhYmVscykpKVxyXG4gICAgICAuY2F0Y2goZXJyb3JNZXNzYWdlID0+IGNvbnNvbGUubG9nKFwiTUwgS2l0IGVycm9yOiBcIiArIGVycm9yTWVzc2FnZSkpO1xyXG5cclxuICAgICAgZmlyZWJhc2UubWxraXQuaW1hZ2VsYWJlbGluZy5sYWJlbEltYWdlQ2xvdWQoe1xyXG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLFxyXG4gICAgICAgICAgbW9kZWxUeXBlOiBcInN0YWJsZVwiLCAvLyBlaXRoZXIgXCJsYXRlc3RcIiBvciBcInN0YWJsZVwiIChkZWZhdWx0IFwic3RhYmxlXCIpXHJcbiAgICAgICAgICBtYXhSZXN1bHRzOiA1IC8vIGRlZmF1bHQgMTBcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlc3VsdDogTUxLaXRJbWFnZUxhYmVsaW5nQ2xvdWRSZXN1bHQpID0+IGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5sYWJlbHMpKSlcclxuICAgICAgLmNhdGNoKGVycm9yTWVzc2FnZSA9PiBjb25zb2xlLmxvZyhcIk1MIEtpdCBlcnJvcjogXCIgKyBlcnJvck1lc3NhZ2UpKTtcclxuICB9XHJcbiAgbGFuZG1hcmtSZWNvZ25pdGlvbigpe1xyXG4gICAgICBjb25zdCBmb2xkZXI6IEZvbGRlciA9IDxGb2xkZXI+IGtub3duRm9sZGVycy5jdXJyZW50QXBwKCk7XHJcbiAgICAgIGNvbnN0IGZvbGRlclBhdGg6IHN0cmluZyA9IHBhdGguam9pbihmb2xkZXIucGF0aCwgXCJpbWFnZXMvNjgwcHgtQnJ1ZWdnZV9WaWV3X2Zyb21fUm96ZW5ob2Vka2FhaS5qcGdcIik7XHJcbiAgICAgIGNvbnN0IGltYWdlU291cmNlOiBJbWFnZVNvdXJjZSA9IDxJbWFnZVNvdXJjZT4gZnJvbUZpbGUoZm9sZGVyUGF0aCk7XHJcbiAgICAgIGZpcmViYXNlLm1sa2l0LmxhbmRtYXJrcmVjb2duaXRpb24ucmVjb2duaXplTGFuZG1hcmtzQ2xvdWQoe1xyXG4gICAgICAgICAgaW1hZ2U6IGltYWdlU291cmNlLFxyXG4gICAgICAgICAgbW9kZWxUeXBlOiBcImxhdGVzdFwiLCAvLyBlaXRoZXIgXCJsYXRlc3RcIiBvciBcInN0YWJsZVwiIChkZWZhdWx0IFwic3RhYmxlXCIpXHJcbiAgICAgICAgICBtYXhSZXN1bHRzOiA4IC8vIGRlZmF1bHQgMTBcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKHJlc3VsdDogTUxLaXRMYW5kbWFya1JlY29nbml0aW9uQ2xvdWRSZXN1bHQpID0+IGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHJlc3VsdC5sYW5kbWFya3MpKSlcclxuICAgICAgLmNhdGNoKGVycm9yTWVzc2FnZSA9PiBjb25zb2xlLmxvZyhcIk1MIEtpdCBlcnJvcjogXCIgKyBlcnJvck1lc3NhZ2UpKTtcclxuICB9XHJcbn1cclxuIl19